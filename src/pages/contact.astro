---
import Layout from '../layouts/Layout.astro';
---

<Layout title="VetPulse | Request Market Intelligence">
  <div class="bg-gray-50 pt-32 pb-16 px-4">
    <div class="max-w-3xl mx-auto">
      <!-- Eyebrow LEFT-ALIGNED -->
      <p class="text-[#0eb4b3] text-sm font-mono font-bold tracking-[0.15em] uppercase mb-6 flex items-center hero-eyebrow">
        <span class="w-2 h-2 bg-[#0eb4b3] inline-block mr-2"></span>
        COMMISSION A BRIEFING
      </p>
      
      <!-- Heading and description CENTERED -->
      <div class="text-center mb-6 hero-content">
        <h1 class="text-3xl font-bold text-[#0b1430] mb-2">
          Request Market Intelligence
        </h1>
        
        <p class="text-gray-600">
          We accept new research mandates on a rolling basis. Projects start at $10k.
        </p>
      </div>
      
      <!-- Form container with border -->
      <div class="bg-white rounded-lg border border-gray-200 shadow-sm p-8 md:p-12 form-container">
        
        <!-- SUCCESS MESSAGE (hidden by default) -->
        <div id="successMessage" class="hidden mb-6 p-4 bg-green-50 border-l-4 border-green-500 rounded-lg">
          <p class="text-green-800 font-semibold">✓ Message sent successfully!</p>
          <p class="text-green-700 text-sm mt-2">We'll get back to you within 24 hours.</p>
        </div>

        <!-- ERROR MESSAGE (hidden by default) -->
        <div id="errorMessage" class="hidden mb-6 p-4 bg-red-50 border-l-4 border-red-500 rounded-lg">
          <p class="text-red-800 font-semibold">✗ Something went wrong</p>
          <p id="errorText" class="text-red-700 text-sm mt-2"></p>
        </div>

        <form id="contactForm" class="space-y-6">
          <div>
            <label for="name" class="block text-sm font-medium text-gray-700 mb-2">
              Name *
            </label>
            <input
              type="text"
              id="name"
              name="name"
              required
              minlength="2"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent"
            />
            <span class="error-message text-red-500 text-sm hidden">Please enter your name (at least 2 characters)</span>
          </div>

          <div>
            <label for="email" class="block text-sm font-medium text-gray-700 mb-2">
              Email *
            </label>
            <input
              type="email"
              id="email"
              name="email"
              required
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent"
            />
            <span class="error-message text-red-500 text-sm hidden">Please enter a valid email</span>
          </div>

          <div>
            <label for="company" class="block text-sm font-medium text-gray-700 mb-2">
              Company
            </label>
            <input
              type="text"
              id="company"
              name="company"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent"
            />
          </div>

          <div>
            <label for="message" class="block text-sm font-medium text-gray-700 mb-2">
              Research Request *
            </label>
            <textarea
              id="message"
              name="message"
              required
              minlength="10"
              rows="5"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent"
            ></textarea>
            <span class="error-message text-red-500 text-sm hidden">Please describe your research needs (at least 10 characters)</span>
          </div>

          <button
            type="submit"
            id="submitBtn"
            class="w-full bg-[#0eb4b3] text-white font-semibold py-3 px-6 rounded-lg hover:bg-[#0d9b9a] transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
          >
            <span id="buttonText">Submit Request</span>
            <span id="buttonLoading" class="hidden">Sending...</span>
          </button>
        </form>

        <p class="text-gray-600 text-sm mt-6 text-center">
          Or contact us directly: <a href="mailto:contact@vetpulse.com" class="text-[#0eb4b3] hover:underline">contact@vetpulse.com</a>
        </p>
      </div>
    </div>
  </div>
</Layout>

<style>
  html {
    scroll-behavior: smooth;
  }
  
  /* Hero eyebrow animation */
  .hero-eyebrow {
    opacity: 0;
    animation: fadeInUp 0.8s ease-out forwards;
  }
  
  /* Hero content animation */
  .hero-content {
    opacity: 0;
    animation: fadeInUp 0.8s ease-out 0.2s forwards;
  }
  
  /* Form container animation */
  .form-container {
    opacity: 0;
    animation: fadeInUp 0.8s ease-out 0.4s forwards;
  }
  
  /* Scroll-triggered fade-in for other sections */
  .fade-in-section {
    opacity: 0;
    transform: translateY(30px);
    transition: opacity 0.8s ease-out, transform 0.8s ease-out;
  }
  
  .fade-in-section.is-visible {
    opacity: 1;
    transform: translateY(0);
  }
  
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
</style>

<script>
  const form = document.getElementById('contactForm') as HTMLFormElement;
  const successMessage = document.getElementById('successMessage');
  const errorMessage = document.getElementById('errorMessage');
  const errorText = document.getElementById('errorText');
  const buttonText = document.getElementById('buttonText');
  const buttonLoading = document.getElementById('buttonLoading');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();

    // Show loading state
    buttonText?.classList.add('hidden');
    buttonLoading?.classList.remove('hidden');

    // Hide previous messages
    successMessage?.classList.add('hidden');
    errorMessage?.classList.add('hidden');

    try {
      // Get form data as object
      const formData = new FormData(form);
      const data = {
        name: formData.get('name'),
        email: formData.get('email'),
        company: formData.get('company') || '',
        message: formData.get('message'),
      };

      console.log('Sending data:', data);

      // Send as JSON
      const response = await fetch('/api/contact', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(data),
      });

      const result = await response.json();
      console.log('Response:', result);

      if (result.success) {
        // Show success message
        successMessage?.classList.remove('hidden');
        form.reset();
        
        // Scroll to success message
        successMessage?.scrollIntoView({ behavior: 'smooth', block: 'center' });
      } else {
        // Show error message
        errorMessage?.classList.remove('hidden');
        if (errorText) {
          errorText.textContent = result.error || 'Please try again later.';
        }
        
        // Scroll to error message
        errorMessage?.scrollIntoView({ behavior: 'smooth', block: 'center' });
      }

    } catch (error) {
      console.error('Form submission error:', error);
      // Network error
      errorMessage?.classList.remove('hidden');
      if (errorText) {
        errorText.textContent = 'Network error. Please check your connection.';
      }
    } finally {
      // Reset button state
      buttonText?.classList.remove('hidden');
      buttonLoading?.classList.add('hidden');
    }
  });
</script>
